# Google Sheets 数据提交调试指南

如果数据没有进入 Google Sheets，请按照以下步骤检查：

## 步骤 1: 检查浏览器控制台

1. 打开问卷页面
2. 按 `F12` 打开开发者工具
3. 切换到 "Console"（控制台）标签
4. 填写并提交问卷
5. 查看控制台输出，应该看到：
   - `========== 准备提交数据 ==========`
   - 姓名、行业、最想学习的AI技能等信息
   - 提交结果

## 步骤 2: 检查 Google Apps Script 配置

### 2.1 确认代码已更新
1. 打开 Google Apps Script 编辑器
2. 确认代码包含以下字段处理：
   - `data.userName` (姓名)
   - `data.userIndustry` (行业)
   - `data.q13Skills` (最想学习的AI技能)
   - `data.totalScore` (总分)
   - `data.level` (等级)

### 2.2 检查 Web App 部署设置
1. 在 Google Apps Script 编辑器中，点击 "部署" > "新建部署"
2. 选择类型：**Web 应用**
3. 执行身份：**我**
4. 具有访问权限的用户：**任何人**
5. 点击 "部署"
6. **重要**：复制新的 Web App URL，更新到 `index.html` 中的 `GOOGLE_SCRIPT_URL`

### 2.3 检查执行日志
1. 在 Google Apps Script 编辑器中，点击 "执行" > "查看执行记录"
2. 查看最近的执行记录，应该能看到：
   - `========== 收到 POST 请求 ==========`
   - 数据解析结果
   - 错误信息（如果有）

## 步骤 3: 检查 Google Sheets 表头

确保 Google Sheets 的第一行包含以下列（按顺序）：
- A列：时间
- B列：姓名
- C列：行业
- D列：最希望学习的AI技能
- E列：# 总分
- F列：等级

如果表头不匹配，可以运行 `setupHeaders()` 函数自动创建。

## 步骤 4: 测试数据提交

### 方法 1: 使用浏览器测试
1. 打开问卷页面
2. 填写所有必填项
3. 提交问卷
4. 检查控制台是否有错误
5. 检查 Google Sheets 是否有新数据

### 方法 2: 使用 Google Apps Script 测试函数
1. 在 Google Apps Script 编辑器中
2. 选择 `test()` 函数
3. 点击运行
4. 查看执行日志
5. 检查 Google Sheets 是否有测试数据

## 常见问题

### 问题 1: CORS 错误
**症状**：控制台显示 CORS 错误
**解决**：
- 确保 Web App 部署设置为"任何人"可访问
- 检查 Google Apps Script URL 是否正确

### 问题 2: 数据格式错误
**症状**：控制台显示数据，但 Google Sheets 没有收到
**解决**：
- 检查 Google Apps Script 的 `processData` 函数
- 确认数据字段名称匹配（userName, userIndustry, q13Skills）

### 问题 3: 权限错误
**症状**：执行记录显示权限错误
**解决**：
- 确保 Google Apps Script 有权限访问 Google Sheets
- 在首次运行时，会提示授权，请点击"允许"

### 问题 4: 表头不匹配
**症状**：数据写入错误的列
**解决**：
- 运行 `setupHeaders()` 函数重新创建表头
- 或手动调整 Google Sheets 表头顺序

## 调试技巧

1. **查看完整数据**：在控制台中查看 `完整数据:` 输出，确认所有字段都有值
2. **检查 URL**：确认 `GOOGLE_SCRIPT_URL` 是正确的 Web App URL
3. **测试连接**：在浏览器中直接访问 Web App URL，应该看到 JSON 响应
4. **查看日志**：在 Google Apps Script 中查看执行记录，了解数据处理过程

## 快速检查清单

- [ ] 浏览器控制台没有错误
- [ ] Google Apps Script 代码已更新
- [ ] Web App 已重新部署
- [ ] Web App URL 已更新到 index.html
- [ ] Web App 访问权限设置为"任何人"
- [ ] Google Sheets 表头正确
- [ ] Google Apps Script 有访问 Google Sheets 的权限
- [ ] 执行记录显示数据已接收


